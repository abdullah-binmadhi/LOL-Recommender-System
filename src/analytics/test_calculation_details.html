<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: showCalculationDetails Function</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
        }
        
        h2 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .unified-recommendation-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .champion-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .champion-image-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #667eea;
        }
        
        .champion-info {
            flex: 1;
        }
        
        .champion-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin: 0 0 5px 0;
        }
        
        .champion-role {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        
        .aggregate-score {
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
        }
        
        .score-number {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .score-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .ml-scores-section {
            margin: 20px 0;
        }
        
        .ml-scores-section h4 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .score-row {
            display: grid;
            grid-template-columns: 200px 1fr 80px 80px;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .score-label-col {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .algorithm-icon {
            font-size: 1.2rem;
        }
        
        .algorithm-name {
            font-weight: 500;
            color: #495057;
        }
        
        .score-bar-container {
            height: 24px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .score-bar {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
        }
        
        .rf-bar { background: linear-gradient(90deg, #28a745, #20c997); }
        .dt-bar { background: linear-gradient(90deg, #007bff, #17a2b8); }
        .knn-bar { background: linear-gradient(90deg, #ffc107, #fd7e14); }
        
        .score-value-col {
            font-size: 1.2rem;
            font-weight: bold;
            color: #495057;
        }
        
        .details-btn {
            padding: 6px 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .details-btn:hover {
            background: #5a6268;
        }
        
        .calculation-details {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #667eea;
        }
        
        .calculation-details.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .calculation-details-content h4 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .details-close-btn {
            float: right;
            padding: 5px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .details-close-btn:hover {
            background: #c82333;
        }
        
        .score-summary {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-item .label {
            font-weight: 600;
            color: #495057;
        }
        
        .detail-item .value {
            color: #28a745;
            font-weight: bold;
        }
        
        .calculation-details-content h5 {
            color: #495057;
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
        }
        
        .factors-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .factors-table th,
        .factors-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .factors-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        .factors-table tr:last-child td {
            border-bottom: none;
        }
        
        .criteria-list {
            list-style: none;
            padding: 0;
            background: white;
            border-radius: 8px;
            padding: 15px;
        }
        
        .criteria-list li {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
        }
        
        .criteria-list li.matched {
            background: #d4edda;
            color: #155724;
        }
        
        .criteria-list li.matched::before {
            content: '‚úì ';
            font-weight: bold;
        }
        
        .criteria-list li.penalty {
            background: #f8d7da;
            color: #721c24;
        }
        
        .criteria-list li.penalty::before {
            content: '‚úó ';
            font-weight: bold;
        }
        
        .btn {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <h1>üß™ Test: showCalculationDetails Function</h1>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Interactive Demo</h2>
        <p>Click the "Details" buttons below to test the showCalculationDetails function:</p>
        <div id="demo-container"></div>
    </div>
    
    <script>
        // Mock champion data
        const allChampions = {
            'Ahri': {
                role: 'Mage',
                difficulty: 5,
                damage: 8,
                toughness: 3,
                utility: 6
            },
            'Lux': {
                role: 'Mage',
                difficulty: 4,
                damage: 7,
                toughness: 2,
                utility: 8
            }
        };
        
        // Mock ML results with detailed calculation data
        const mlResults = {
            top5: [
                {
                    championName: 'Ahri',
                    randomForest: 85.3,
                    decisionTree: 78.2,
                    knn: 82.1,
                    average: 81.9,
                    details: {
                        randomForest: {
                            rawScore: 145,
                            contributingFactors: [
                                { factor: 'Role Match', weight: 40, contribution: 40 },
                                { factor: 'Position Match', weight: 30, contribution: 30 },
                                { factor: 'Difficulty Match', weight: 20, contribution: 18 },
                                { factor: 'Damage Match', weight: 15, contribution: 14 },
                                { factor: 'Playstyle Bonus', weight: 20, contribution: 20 }
                            ],
                            matchedCriteria: [
                                'Role: Mage',
                                'High damage for aggressive playstyle',
                                'Difficulty within preferred range'
                            ],
                            penalties: []
                        },
                        decisionTree: {
                            rawScore: 133,
                            contributingFactors: [
                                { factor: 'Role Match (Level 1)', weight: 50, contribution: 50 },
                                { factor: 'Position Match (Level 2)', weight: 40, contribution: 40 },
                                { factor: 'Difficulty Match (Level 3)', weight: 30, contribution: 25 },
                                { factor: 'Attribute Bonuses', weight: 20, contribution: 18 }
                            ],
                            matchedCriteria: [
                                'Role: Mage',
                                'Position matches',
                                'Difficulty acceptable'
                            ],
                            penalties: [
                                'Minor penalty for toughness mismatch'
                            ]
                        },
                        knn: {
                            rawScore: 5.3,
                            contributingFactors: [
                                { factor: 'Role Distance', weight: 0, contribution: 0 },
                                { factor: 'Difficulty Distance', weight: 0.5, contribution: 0.5 },
                                { factor: 'Damage Distance', weight: 0.3, contribution: 0.3 },
                                { factor: 'Toughness Distance', weight: 0.3, contribution: 1.5 }
                            ],
                            matchedCriteria: [
                                'Role: Mage',
                                'Close difficulty match',
                                'Good damage alignment'
                            ],
                            penalties: []
                        }
                    }
                },
                {
                    championName: 'Lux',
                    randomForest: 78.2,
                    decisionTree: 84.1,
                    knn: 77.8,
                    average: 80.0,
                    details: {
                        randomForest: {
                            rawScore: 133,
                            contributingFactors: [
                                { factor: 'Role Match', weight: 40, contribution: 40 },
                                { factor: 'Position Match', weight: 30, contribution: 30 },
                                { factor: 'Difficulty Match', weight: 20, contribution: 16 },
                                { factor: 'Utility Bonus', weight: 15, contribution: 15 }
                            ],
                            matchedCriteria: [
                                'Role: Mage',
                                'High utility for supportive playstyle',
                                'Easy to moderate difficulty'
                            ],
                            penalties: []
                        },
                        decisionTree: {
                            rawScore: 143,
                            contributingFactors: [
                                { factor: 'Role Match (Level 1)', weight: 50, contribution: 50 },
                                { factor: 'Position Match (Level 2)', weight: 40, contribution: 40 },
                                { factor: 'Difficulty Match (Level 3)', weight: 30, contribution: 28 },
                                { factor: 'Attribute Bonuses', weight: 20, contribution: 20 }
                            ],
                            matchedCriteria: [
                                'Role: Mage',
                                'Position matches',
                                'Difficulty perfect match',
                                'High utility score'
                            ],
                            penalties: []
                        },
                        knn: {
                            rawScore: 6.6,
                            contributingFactors: [
                                { factor: 'Role Distance', weight: 0, contribution: 0 },
                                { factor: 'Difficulty Distance', weight: 0.5, contribution: 1.0 },
                                { factor: 'Damage Distance', weight: 0.3, contribution: 0.6 },
                                { factor: 'Utility Distance', weight: 0.3, contribution: 0.6 }
                            ],
                            matchedCriteria: [
                                'Role: Mage',
                                'Moderate difficulty match',
                                'Good utility alignment'
                            ],
                            penalties: []
                        }
                    }
                }
            ]
        };
        
        // Copy the showCalculationDetails function from src/index.html
        function showCalculationDetails(algorithm, championName) {
            // Task 8.1: Accept algorithm and championName parameters
            if (!mlResults || !mlResults.top5) {
                console.error('No ML results available');
                return;
            }
            
            // Task 8.2: Retrieve champion details
            const champion = mlResults.top5.find(c => c.championName === championName);
            if (!champion || !champion.details || !champion.details[algorithm]) {
                console.error(`Details not found for ${algorithm} - ${championName}`);
                return;
            }
            
            const details = champion.details[algorithm];
            const detailsContainer = document.getElementById(`details-${championName.replace(/[^a-zA-Z0-9]/g, '')}`);
            
            if (!detailsContainer) {
                console.error(`Details container not found for ${championName}`);
                return;
            }
            
            // Toggle visibility
            if (detailsContainer.classList.contains('show')) {
                detailsContainer.classList.remove('show');
                detailsContainer.style.display = 'none';
                return;
            }
            
            // Task 8.3: Build details HTML
            const algorithmNames = {
                'randomForest': 'Random Forest',
                'decisionTree': 'Decision Tree',
                'knn': 'K-Nearest Neighbors'
            };
            
            let html = `
                <div class="calculation-details-content">
                    <button class="details-close-btn" onclick="showCalculationDetails('${algorithm}', '${championName}')">
                        Close
                    </button>
                    <h4>${algorithmNames[algorithm]} Calculation for ${championName}</h4>
                    
                    <div class="score-summary">
                        <div class="detail-item">
                            <span class="label">Raw Score:</span>
                            <span class="value">${details.rawScore ? details.rawScore.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Normalized Score:</span>
                            <span class="value">${champion[algorithm].toFixed(1)}%</span>
                        </div>
                    </div>
            `;
            
            // Contributing Factors Table
            if (details.contributingFactors && details.contributingFactors.length > 0) {
                html += `
                    <h5>Contributing Factors</h5>
                    <table class="factors-table">
                        <thead>
                            <tr>
                                <th>Factor</th>
                                <th>Weight</th>
                                <th>Contribution</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                details.contributingFactors.forEach(factor => {
                    html += `
                        <tr>
                            <td>${factor.factor}</td>
                            <td>${factor.weight}</td>
                            <td>${typeof factor.contribution === 'number' ? factor.contribution.toFixed(2) : factor.contribution}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }
            
            // Matched Criteria
            if (details.matchedCriteria && details.matchedCriteria.length > 0) {
                html += `
                    <h5>Matched Criteria</h5>
                    <ul class="criteria-list">
                `;
                
                details.matchedCriteria.forEach(criterion => {
                    html += `<li class="matched">${criterion}</li>`;
                });
                
                html += `</ul>`;
            }
            
            // Penalties Applied
            if (details.penalties && details.penalties.length > 0) {
                html += `
                    <h5>Penalties Applied</h5>
                    <ul class="criteria-list">
                `;
                
                details.penalties.forEach(penalty => {
                    html += `<li class="penalty">${penalty}</li>`;
                });
                
                html += `</ul>`;
            }
            
            html += `</div>`;
            
            // Task 8.4: Display details
            detailsContainer.innerHTML = html;
            detailsContainer.style.display = 'block';
            detailsContainer.classList.add('show');
            
            // Scroll to details
            detailsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            console.log(`‚úÖ Displayed calculation details for ${algorithmNames[algorithm]} - ${championName}`);
        }
        
        // Run tests
        function runTests() {
            const results = [];
            
            // Test 8.1: Function accepts parameters
            try {
                const testFunc = showCalculationDetails.toString();
                if (testFunc.includes('algorithm') && testFunc.includes('championName')) {
                    results.push({ name: 'Task 8.1: Accept algorithm and championName parameters', pass: true });
                } else {
                    results.push({ name: 'Task 8.1: Accept algorithm and championName parameters', pass: false, error: 'Parameters not found' });
                }
            } catch (e) {
                results.push({ name: 'Task 8.1: Accept algorithm and championName parameters', pass: false, error: e.message });
            }
            
            // Test 8.2: Retrieve champion details
            try {
                const champion = mlResults.top5.find(c => c.championName === 'Ahri');
                if (champion && champion.details && champion.details.randomForest) {
                    results.push({ name: 'Task 8.2: Retrieve champion details', pass: true });
                } else {
                    results.push({ name: 'Task 8.2: Retrieve champion details', pass: false, error: 'Details not found' });
                }
            } catch (e) {
                results.push({ name: 'Task 8.2: Retrieve champion details', pass: false, error: e.message });
            }
            
            // Test 8.3: Build details HTML
            try {
                const testFunc = showCalculationDetails.toString();
                const hasScoreSummary = testFunc.includes('score-summary');
                const hasFactorsTable = testFunc.includes('factors-table');
                const hasCriteriaList = testFunc.includes('criteria-list');
                const hasPenalties = testFunc.includes('penalties');
                
                if (hasScoreSummary && hasFactorsTable && hasCriteriaList && hasPenalties) {
                    results.push({ name: 'Task 8.3: Build details HTML (score summary, factors, criteria, penalties)', pass: true });
                } else {
                    results.push({ name: 'Task 8.3: Build details HTML', pass: false, error: 'Missing HTML elements' });
                }
            } catch (e) {
                results.push({ name: 'Task 8.3: Build details HTML', pass: false, error: e.message });
            }
            
            // Test 8.4: Display details
            try {
                const testFunc = showCalculationDetails.toString();
                if (testFunc.includes('innerHTML') && testFunc.includes('style.display')) {
                    results.push({ name: 'Task 8.4: Display details (insert HTML and show section)', pass: true });
                } else {
                    results.push({ name: 'Task 8.4: Display details', pass: false, error: 'Display logic not found' });
                }
            } catch (e) {
                results.push({ name: 'Task 8.4: Display details', pass: false, error: e.message });
            }
            
            // Test 8.5: Add close button
            try {
                const testFunc = showCalculationDetails.toString();
                if (testFunc.includes('details-close-btn') && testFunc.includes('Close')) {
                    results.push({ name: 'Task 8.5: Add close button (allows collapsing details)', pass: true });
                } else {
                    results.push({ name: 'Task 8.5: Add close button', pass: false, error: 'Close button not found' });
                }
            } catch (e) {
                results.push({ name: 'Task 8.5: Add close button', pass: false, error: e.message });
            }
            
            // Display results
            const resultsContainer = document.getElementById('test-results');
            results.forEach(result => {
                const div = document.createElement('div');
                div.className = result.pass ? 'test-result test-pass' : 'test-result test-fail';
                div.innerHTML = `
                    <strong>${result.pass ? '‚úÖ PASS' : '‚ùå FAIL'}</strong>: ${result.name}
                    ${result.error ? `<br><em>Error: ${result.error}</em>` : ''}
                `;
                resultsContainer.appendChild(div);
            });
            
            // Summary
            const passCount = results.filter(r => r.pass).length;
            const totalCount = results.length;
            const summary = document.createElement('div');
            summary.className = passCount === totalCount ? 'test-result test-pass' : 'test-result test-fail';
            summary.innerHTML = `<strong>Summary: ${passCount}/${totalCount} tests passed</strong>`;
            resultsContainer.appendChild(summary);
        }
        
        // Create demo
        function createDemo() {
            const container = document.getElementById('demo-container');
            
            mlResults.top5.forEach((champion, index) => {
                const championData = allChampions[champion.championName];
                
                const card = document.createElement('div');
                card.className = 'unified-recommendation-card';
                
                card.innerHTML = `
                    <div class="champion-header">
                        <div style="width: 80px; height: 80px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: bold;">
                            ${champion.championName.charAt(0)}
                        </div>
                        <div class="champion-info">
                            <h3 class="champion-name">${champion.championName}</h3>
                            <span class="champion-role">${championData.role}</span>
                        </div>
                        <div class="aggregate-score">
                            <div class="score-number">${champion.average.toFixed(1)}%</div>
                            <div class="score-label">Overall Match</div>
                        </div>
                    </div>
                    
                    <div class="ml-scores-section">
                        <h4>ML Algorithm Scores</h4>
                        
                        <div class="score-row">
                            <div class="score-label-col">
                                <span class="algorithm-icon">üå≥</span>
                                <span class="algorithm-name">Random Forest</span>
                            </div>
                            <div class="score-bar-col">
                                <div class="score-bar-container">
                                    <div class="score-bar rf-bar" style="width: ${champion.randomForest}%"></div>
                                </div>
                            </div>
                            <div class="score-value-col">${champion.randomForest.toFixed(1)}%</div>
                            <button class="details-btn" onclick="showCalculationDetails('randomForest', '${champion.championName}')">
                                Details
                            </button>
                        </div>
                        
                        <div class="score-row">
                            <div class="score-label-col">
                                <span class="algorithm-icon">üéØ</span>
                                <span class="algorithm-name">Decision Tree</span>
                            </div>
                            <div class="score-bar-col">
                                <div class="score-bar-container">
                                    <div class="score-bar dt-bar" style="width: ${champion.decisionTree}%"></div>
                                </div>
                            </div>
                            <div class="score-value-col">${champion.decisionTree.toFixed(1)}%</div>
                            <button class="details-btn" onclick="showCalculationDetails('decisionTree', '${champion.championName}')">
                                Details
                            </button>
                        </div>
                        
                        <div class="score-row">
                            <div class="score-label-col">
                                <span class="algorithm-icon">‚ö°</span>
                                <span class="algorithm-name">K-Nearest Neighbors</span>
                            </div>
                            <div class="score-bar-col">
                                <div class="score-bar-container">
                                    <div class="score-bar knn-bar" style="width: ${champion.knn}%"></div>
                                </div>
                            </div>
                            <div class="score-value-col">${champion.knn.toFixed(1)}%</div>
                            <button class="details-btn" onclick="showCalculationDetails('knn', '${champion.championName}')">
                                Details
                            </button>
                        </div>
                    </div>
                    
                    <div class="calculation-details" id="details-${champion.championName.replace(/[^a-zA-Z0-9]/g, '')}">
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // Run tests and create demo on page load
        window.addEventListener('DOMContentLoaded', () => {
            runTests();
            createDemo();
        });
    </script>
</body>
</html>
