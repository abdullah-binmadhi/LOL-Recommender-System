{% extends "base.html" %}

{% block title %}Session Comparison - LoL Champion Recommender{% endblock %}

{% block content %}
<div class="recommendation-container">
    <!-- Header -->
    <div class="text-center mb-4">
        <h1 class="mb-3" style="color: var(--accent-gold); font-weight: 700;">
            <i class="fas fa-balance-scale me-3"></i>Session Comparison
        </h1>
        <p class="text-muted">Compare your current and previous questionnaire results</p>
    </div>
    
    <!-- Comparison Overview -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-chart-bar me-2" style="color: var(--accent-blue);"></i>
                Comparison Overview
            </h5>
        </div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col-md-3">
                    <div class="text-warning fw-bold">
                        {% set same_answers = 0 %}
                        {% for q_id, answer in comparison.current.responses.items() %}
                            {% if comparison.previous.responses.get(q_id) == answer %}
                                {% set same_answers = same_answers + 1 %}
                            {% endif %}
                        {% endfor %}
                        {{ same_answers }}/{{ comparison.current.responses|length }}
                    </div>
                    <small class="text-muted">Same Answers</small>
                </div>
                <div class="col-md-3">
                    <div class="text-warning fw-bold">
                        {% if comparison.current.recommendation.champion.name == comparison.previous.recommendation.champion.name %}
                            Same
                        {% else %}
                            Different
                        {% endif %}
                    </div>
                    <small class="text-muted">Recommendation</small>
                </div>
                <div class="col-md-3">
                    <div class="text-warning fw-bold">
                        {{ "%.1f"|format((comparison.current.recommendation.confidence_score - comparison.previous.recommendation.confidence_score) * 100) }}%
                    </div>
                    <small class="text-muted">Confidence Diff</small>
                </div>
                <div class="col-md-3">
                    <div class="text-warning fw-bold">
                        {% if comparison.current.recommendation.champion.role == comparison.previous.recommendation.champion.role %}
                            Same
                        {% else %}
                            Different
                        {% endif %}
                    </div>
                    <small class="text-muted">Role Match</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Side-by-Side Comparison -->
    <div class="row">
        <!-- Current Session -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-star me-2"></i>Current Session
                    </h5>
                    <small>{{ comparison.current.session_id[:8] }}...</small>
                </div>
                <div class="card-body">
                    <!-- Champion -->
                    <div class="text-center mb-4">
                        <div class="champion-image-placeholder bg-success text-white d-flex align-items-center justify-content-center rounded mb-2" 
                             style="width: 80px; height: 80px; margin: 0 auto;">
                            <i class="fas fa-crown fa-2x"></i>
                        </div>
                        <h5 class="text-success">{{ comparison.current.recommendation.champion.name }}</h5>
                        <p class="text-muted small">{{ comparison.current.recommendation.champion.title }}</p>
                        <div class="mb-2">
                            <span class="badge bg-success">{{ comparison.current.recommendation.champion.role }}</span>
                            <span class="badge bg-info">{{ "%.1f"|format(comparison.current.recommendation.confidence_score * 100) }}%</span>
                        </div>
                    </div>
                    
                    <!-- Responses -->
                    <h6 class="text-success mb-3">Your Answers:</h6>
                    {% for question in questions %}
                        {% set answer = comparison.current.responses.get(question.id|string) %}
                        {% if answer %}
                        <div class="mb-2 p-2 rounded" style="background: rgba(40, 167, 69, 0.1);">
                            <small class="text-muted">{{ question.text }}</small>
                            <div class="fw-bold">{{ answer }}</div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Previous Session -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-history me-2"></i>Previous Session
                    </h5>
                    <small>
                        {{ comparison.previous.session_id[:8] }}... 
                        ({{ comparison.previous.completed_at[:10] if comparison.previous.completed_at else 'Unknown' }})
                    </small>
                </div>
                <div class="card-body">
                    <!-- Champion -->
                    <div class="text-center mb-4">
                        <div class="champion-image-placeholder bg-info text-white d-flex align-items-center justify-content-center rounded mb-2" 
                             style="width: 80px; height: 80px; margin: 0 auto;">
                            <i class="fas fa-crown fa-2x"></i>
                        </div>
                        <h5 class="text-info">{{ comparison.previous.recommendation.champion.name }}</h5>
                        <p class="text-muted small">{{ comparison.previous.recommendation.champion.title }}</p>
                        <div class="mb-2">
                            <span class="badge bg-info">{{ comparison.previous.recommendation.champion.role }}</span>
                            <span class="badge bg-secondary">{{ "%.1f"|format(comparison.previous.recommendation.confidence_score * 100) }}%</span>
                        </div>
                    </div>
                    
                    <!-- Responses -->
                    <h6 class="text-info mb-3">Previous Answers:</h6>
                    {% for question in questions %}
                        {% set answer = comparison.previous.responses.get(question.id|string) %}
                        {% if answer %}
                        <div class="mb-2 p-2 rounded" style="background: rgba(23, 162, 184, 0.1);">
                            <small class="text-muted">{{ question.text }}</small>
                            <div class="fw-bold 
                                {% if comparison.current.responses.get(question.id|string) == answer %}
                                    text-success
                                {% else %}
                                    text-warning
                                {% endif %}
                            ">
                                {{ answer }}
                                {% if comparison.current.responses.get(question.id|string) != answer %}
                                    <i class="fas fa-exclamation-triangle ms-1" title="Different from current"></i>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Detailed Analysis -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-microscope me-2" style="color: var(--accent-purple);"></i>
                Detailed Analysis
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-success">Current Recommendation Reasons:</h6>
                    <ul class="list-unstyled">
                        {% for reason in comparison.current.recommendation.match_reasons %}
                        <li class="mb-1">
                            <i class="fas fa-check text-success me-2"></i>{{ reason }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6 class="text-info">Previous Recommendation Reasons:</h6>
                    <ul class="list-unstyled">
                        {% for reason in comparison.previous.recommendation.match_reasons %}
                        <li class="mb-1">
                            <i class="fas fa-check text-info me-2"></i>{{ reason }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="text-center">
        <a href="{{ url_for('session_history') }}" class="btn btn-outline-primary me-3">
            <i class="fas fa-arrow-left me-2"></i>Back to History
        </a>
        <a href="{{ url_for('recommendation') }}" class="btn btn-success me-3">
            <i class="fas fa-star me-2"></i>Current Recommendation
        </a>
        <a href="{{ url_for('retake') }}" class="btn btn-secondary">
            <i class="fas fa-sync-alt me-2"></i>New Session
        </a>
    </div>
</div>
{% endblock %}